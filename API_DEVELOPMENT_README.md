# üöÄ API Development Tools & Documentation

This directory contains comprehensive tools and documentation for developing with the Automagik Omni API.

## üìÅ Files Overview

| File | Purpose | Usage |
|------|---------|-------|
| **`COMPLETE_API_GUIDE.md`** | üìö Comprehensive API documentation | Read for complete endpoint reference |
| **`test_api_endpoints.sh`** | üß™ Interactive API testing script | Run to test all endpoints live |
| **`generate_api_docs.sh`** | ü§ñ Automated documentation generator | Run to generate fresh docs |
| **`API_DOCUMENTATION.md`** | üìÑ Auto-generated API docs | Generated by the doc script |

## üéØ Quick Start for Developers

### 1. Test All Endpoints
```bash
# Make sure the API is running (make dev)
./test_api_endpoints.sh
```

### 2. Read Complete Documentation
```bash
# Open the comprehensive guide
code COMPLETE_API_GUIDE.md
# or
cat COMPLETE_API_GUIDE.md
```

### 3. Generate Fresh Documentation
```bash
# Auto-generate docs from live API
./generate_api_docs.sh
```

## üî• What You Get

### ‚úÖ **Complete API Coverage**
- **Health & System endpoints** - Server status and capabilities
- **Instance Management** - CRUD operations for WhatsApp instances  
- **Instance Operations** - QR codes, status, restart, logout
- **Message Sending** - Text, media, audio, contacts, reactions
- **Traces & Analytics** - Message tracking and performance metrics
- **Webhooks** - Incoming message processing
- **Error Handling** - Comprehensive error scenarios

### ‚úÖ **Real Examples**
- **curl commands** for every endpoint
- **Request/response payloads** with real data
- **Filtering & pagination** examples
- **Error scenarios** with proper status codes
- **Frontend integration** code (JavaScript/Python)

### ‚úÖ **Advanced Features**
- **Multi-tenant routing** - Instance-specific webhooks
- **Authentication** - Bearer token examples
- **Validation errors** - Detailed field-level feedback
- **Performance tips** - Optimization strategies
- **Batch operations** - Scripts for multiple operations

## üìä API Endpoint Summary

### Core Endpoints
```bash
# Health check
GET  /health

# Instance management
GET    /api/v1/instances
POST   /api/v1/instances
GET    /api/v1/instances/{name}
PUT    /api/v1/instances/{name}
DELETE /api/v1/instances/{name}

# Instance operations
GET  /api/v1/instances/{name}/qr
GET  /api/v1/instances/{name}/status
POST /api/v1/instances/{name}/set-default
POST /api/v1/instances/{name}/restart
POST /api/v1/instances/{name}/logout

# Message sending
POST /api/v1/instance/{name}/send-text
POST /api/v1/instance/{name}/send-media
POST /api/v1/instance/{name}/send-audio
POST /api/v1/instance/{name}/send-contact
POST /api/v1/instance/{name}/send-reaction
POST /api/v1/instance/{name}/fetch-profile

# Traces & analytics
GET /api/v1/traces
GET /api/v1/traces/{trace_id}
GET /api/v1/traces/{trace_id}/payloads
GET /api/v1/analytics/summary

# Webhooks
POST /webhook/evolution/{instance_name}
POST /webhook/evolution  # Default instance
```

## üé® Frontend Integration Examples

### JavaScript/React
```javascript
import { AutomagikAPI } from './automagik-api';

const api = new AutomagikAPI();

// List instances
const instances = await api.listInstances();

// Send message
await api.sendText('my-instance', '+1234567890', 'Hello!');

// Get traces
const traces = await api.getTraces({ limit: 10, status: 'completed' });
```

### Python/Flask
```python
from automagik_api import AutomagikAPI

api = AutomagikAPI()

# Create instance
instance = api.create_instance({
    'name': 'new-instance',
    'channel_type': 'whatsapp',
    'evolution_url': 'http://evolution:8080',
    'evolution_key': 'your-key',
    'agent_api_url': 'http://agent:8000',
    'agent_api_key': 'agent-key',
    'default_agent': 'my-agent'
})

# Send message
result = api.send_text('new-instance', '+1234567890', 'Hello from Python!')
```

## üõ† Development Workflow

### 1. Start Development Server
```bash
make dev
# Server runs on http://localhost:18882
```

### 2. Test Endpoints
```bash
# Quick test
./test_api_endpoints.sh

# Specific endpoint test
curl -H "Authorization: Bearer namastex888" \
     http://localhost:18882/api/v1/instances
```

### 3. View Interactive Docs
```bash
# Open browser to:
http://localhost:18882/api/v1/docs
```

### 4. Check Logs
```bash
# View server logs
make logs
```

## üîç Filtering & Query Examples

### Instance Filtering
```bash
# Pagination
curl "http://localhost:18882/api/v1/instances?skip=0&limit=5"

# Without Evolution status (faster)
curl "http://localhost:18882/api/v1/instances?include_status=false"
```

### Trace Filtering
```bash
# By status
curl "http://localhost:18882/api/v1/traces?status=completed"

# By instance
curl "http://localhost:18882/api/v1/traces?instance_name=my-instance"

# By date range
curl "http://localhost:18882/api/v1/traces?start_date=2025-07-01&end_date=2025-07-31"

# By message type
curl "http://localhost:18882/api/v1/traces?message_type=audio&has_media=true"

# Complex filtering
curl "http://localhost:18882/api/v1/traces?status=completed&instance_name=my-instance&limit=10"
```

## üö® Error Handling Guide

### HTTP Status Codes
- **200 OK** - Success
- **201 Created** - Resource created
- **204 No Content** - Success, no response body
- **400 Bad Request** - Invalid request
- **401 Unauthorized** - Missing/invalid API key
- **404 Not Found** - Resource not found
- **422 Unprocessable Entity** - Validation error
- **500 Internal Server Error** - Server error

### Common Error Responses
```json
// Simple error
{
  "detail": "Instance 'nonexistent' not found"
}

// Validation error
{
  "detail": [
    {
      "type": "missing",
      "loc": ["body", "name"],
      "msg": "Field required"
    }
  ]
}
```

## üîê Authentication

All endpoints (except `/health` and webhooks) require authentication:

```bash
# Required header
Authorization: Bearer your_api_key_here

# Example
curl -H "Authorization: Bearer namastex888" \
     -H "Content-Type: application/json" \
     http://localhost:18882/api/v1/instances
```

## üåê Multi-Tenant Architecture

### Instance-Specific Webhooks
```bash
# Each instance gets its own webhook URL
POST /webhook/evolution/{instance_name}

# Example for instance "my-whatsapp"
POST /webhook/evolution/my-whatsapp
```

### Configuration Isolation
- Each instance has its own Evolution API credentials
- Separate agent configurations per instance
- Independent webhook settings
- Isolated message processing

## üìà Performance Tips

### 1. Disable Evolution Status for Faster Listing
```bash
curl "http://localhost:18882/api/v1/instances?include_status=false"
```

### 2. Use Pagination for Large Results
```bash
curl "http://localhost:18882/api/v1/traces?limit=20&skip=0"
```

### 3. Filter Traces by Date Range
```bash
curl "http://localhost:18882/api/v1/traces?start_date=2025-07-17&end_date=2025-07-17"
```

### 4. Use Specific Filters
```bash
# Better: specific filters
curl "http://localhost:18882/api/v1/traces?instance_name=my-instance&status=completed"

# Avoid: broad queries
curl "http://localhost:18882/api/v1/traces"
```

## üéâ Ready to Build!

You now have everything you need to integrate with the Automagik Omni API:

‚úÖ **Complete documentation** with real examples  
‚úÖ **Working test scripts** to verify functionality  
‚úÖ **Frontend integration** examples  
‚úÖ **Error handling** patterns  
‚úÖ **Performance optimization** tips  
‚úÖ **Multi-tenant support** guidance  

### Next Steps:
1. **Configure your instances** - Set up WhatsApp connections
2. **Set up webhooks** - Configure Evolution API to send events
3. **Build your frontend** - Use the provided integration examples
4. **Monitor with traces** - Track message processing and performance

---

*For support or questions, refer to the complete documentation in `COMPLETE_API_GUIDE.md` or the interactive docs at `http://localhost:18882/api/v1/docs`*