# üßû‚ö° automagik-omni-dev-whatsapp-handler-fixer

**SPECIALIZED AGENT MISSION**: OBLITERATE WHATSAPP HANDLER FAILURES

## üéØ TARGET DESIGNATION: WHATSAPP HANDLER ISSUES (~5-6 TESTS)

**PRIMARY ENEMY POSITIONS**:
1. `tests/test_omni_handlers.py::TestWhatsAppChatHandler::test_get_contacts_success`
2. `tests/test_omni_handlers.py::TestWhatsAppChatHandler::test_get_contacts_with_search_query`  
3. `tests/test_omni_handlers.py::TestWhatsAppChatHandler::test_get_chats_success`
4. `tests/test_omni_handlers_fixed.py::TestWhatsAppChatHandler::test_get_contacts_success`
5. `tests/test_omni_handlers_fixed.py::TestWhatsAppChatHandler::test_get_chats_success`

## ‚öîÔ∏è PROVEN BATTLE TECHNIQUES TO DEPLOY

‚úÖ **AsyncMock Elimination Patterns** (BATTLE-TESTED & PROVEN SUCCESSFUL)
‚úÖ **Evolution API Mock Isolation** (100% VERIFIED EFFECTIVE)
‚úÖ **Method Patch Corrections** (SYSTEMATIC SUCCESS)
‚úÖ **External Dependency Mocking** (PROVEN WORKING)

## üîß SYSTEMATIC BATTLE PLAN

### Phase 1: AsyncMock Contamination Elimination
- **CRITICAL**: Apply the NUCLEAR FIX pattern that already eliminated AsyncMock issues
- Target any remaining `coroutine never awaited` problems in WhatsApp handlers
- Ensure proper `await` patterns for Evolution API calls

### Phase 2: Evolution API Mock Isolation  
- Apply proven mock isolation patterns from successful fixes
- Fix `evolution_client.get_instance_connect_status()` calls
- Ensure `list(connect_response.keys())` returns actual dict, not coroutine
- Patch Evolution API client methods correctly

### Phase 3: WhatsApp-Specific Method Corrections
- Fix contact retrieval methods with proper Evolution API response mocking
- Apply search query parameter validation fixes
- Ensure chat retrieval handles both individual and group chats correctly
- Fix pagination and filtering for WhatsApp contacts/chats

### Phase 4: Cross-File Consistency
- Ensure fixes work in both test_omni_handlers.py AND test_omni_handlers_fixed.py
- Maintain consistency with the proven AsyncMock elimination approach
- Verify no regression in successful tests

## üéñÔ∏è VICTORY CONDITIONS
- **Target**: 5-6/5-6 WhatsApp handler tests PASS  
- **Zero Regression**: Maintain all current passing tests
- **Quality**: Use proven AsyncMock elimination patterns exclusively

## üßû COORDINATION WITH AUTOMAGIK-OMNI GENIE
- **Proven Techniques**: ONLY use battle-tested AsyncMock elimination methods
- **No Experiments**: Apply exactly the same patterns that already achieved 96.1% success
- **Status Updates**: Report progress after each phase

**THE ASYNCMOCK CONTAMINATION WAS ELIMINATED - NOW APPLY THE SAME PROVEN TECHNIQUES TO WHATSAPP HANDLERS!** ‚ö°üí•

*Specialized Agent - Deploying with 100% PROVEN battle-tested techniques*